<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>COBE 2026 â€“ English Speaking Practice</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Nunito:wght@400;600;700;800&display=swap');
  :root {
    --bg: #f0f4ff;
    --white: #ffffff;
    --navy: #1a2744;
    --teal: #0e9d8a;
    --teal-light: #e0f7f4;
    --gold: #f5a623;
    --gold-light: #fff8e7;
    --blue: #3b82f6;
    --blue-light: #eff6ff;
    --red: #ef4444;
    --orange: #f97316;
    --green: #22c55e;
    --green-light: #f0fdf4;
    --purple: #8b5cf6;
    --gray: #64748b;
    --gray-light: #f1f5f9;
    --border: #e2e8f0;
    --shadow: 0 4px 24px rgba(30,50,100,.10);
    --shadow-lg: 0 8px 40px rgba(30,50,100,.15);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Nunito', sans-serif; background: var(--bg); color: var(--navy); min-height: 100vh; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE 1: NAME SCREEN
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #page-name {
    min-height: 100vh;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    padding: 40px 20px;
    background: linear-gradient(145deg, #1a2744 0%, #0e3a5c 50%, #0e9d8a 100%);
  }
  .name-screen-logo {
    background: var(--gold); color: var(--navy);
    font-family: 'Playfair Display', serif; font-size: 13px; font-weight: 700;
    letter-spacing: 3px; padding: 6px 20px; border-radius: 30px; margin-bottom: 28px;
  }
  #page-name h1 {
    font-family: 'Playfair Display', serif; font-size: 46px; color: #ffffff;
    text-align: center; line-height: 1.15; margin-bottom: 8px;
  }
  #page-name h1 span { color: var(--gold); }
  #page-name .tagline { font-size: 17px; color: rgba(255,255,255,0.7); text-align: center; margin-bottom: 44px; }

  .name-card {
    background: white; border-radius: 24px; padding: 44px 48px;
    box-shadow: var(--shadow-lg); max-width: 480px; width: 100%; text-align: center;
  }
  .name-card .avatar { font-size: 56px; margin-bottom: 16px; }
  .name-card h2 { font-size: 24px; font-weight: 800; color: var(--navy); margin-bottom: 6px; }
  .name-card p { font-size: 15px; color: var(--gray); margin-bottom: 28px; }
  .name-input-wrap { position: relative; margin-bottom: 20px; }
  .name-input-wrap input {
    width: 100%; padding: 16px 20px; border-radius: 14px;
    border: 2px solid var(--border); font-family: 'Nunito', sans-serif;
    font-size: 17px; font-weight: 600; color: var(--navy);
    outline: none; transition: border-color .2s, box-shadow .2s;
    background: var(--gray-light);
  }
  .name-input-wrap input:focus { border-color: var(--teal); box-shadow: 0 0 0 4px rgba(14,157,138,.12); background: white; }
  .name-input-wrap input::placeholder { color: #94a3b8; font-weight: 400; }
  .name-next-btn {
    width: 100%; padding: 16px; border-radius: 14px; border: none;
    background: linear-gradient(135deg, var(--teal), #0b7a6a);
    color: white; font-family: 'Nunito', sans-serif; font-size: 17px; font-weight: 800;
    cursor: pointer; transition: all .2s; letter-spacing: 0.3px;
  }
  .name-next-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(14,157,138,.35); }
  .name-next-btn:disabled { background: #cbd5e1; cursor: not-allowed; transform: none; box-shadow: none; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE 2: LEVEL SCREEN
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #page-level {
    display: none; min-height: 100vh;
    background: var(--bg);
  }
  .level-header {
    background: linear-gradient(135deg, var(--navy), #0e3a5c);
    padding: 22px 40px; display: flex; align-items: center; gap: 16px;
  }
  .level-header .badge { background: var(--gold); color: var(--navy); font-size: 12px; font-weight: 800; letter-spacing: 2px; padding: 5px 14px; border-radius: 30px; }
  .level-header h1 { font-family: 'Playfair Display', serif; font-size: 22px; color: white; }
  .greeting-chip {
    margin-left: auto; background: rgba(255,255,255,.12); border-radius: 30px;
    padding: 8px 18px; font-size: 14px; font-weight: 700; color: white;
  }

  .level-body { padding: 48px 40px; max-width: 900px; margin: 0 auto; }
  .level-body h2 { font-family: 'Playfair Display', serif; font-size: 32px; color: var(--navy); margin-bottom: 8px; text-align: center; }
  .level-body .sub { font-size: 16px; color: var(--gray); text-align: center; margin-bottom: 40px; }

  .level-cards { display: flex; gap: 28px; flex-wrap: wrap; justify-content: center; }
  .level-card {
    background: white; border-radius: 22px; padding: 36px 30px;
    width: 380px; cursor: pointer; transition: all .25s;
    box-shadow: var(--shadow); border: 2px solid transparent;
    text-align: left; position: relative; overflow: hidden;
  }
  .level-card::after {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 5px;
    border-radius: 22px 22px 0 0;
  }
  .level-card.basic::after { background: linear-gradient(90deg, var(--teal), #0b7a6a); }
  .level-card.advanced::after { background: linear-gradient(90deg, var(--gold), #e8931a); }
  .level-card:hover { transform: translateY(-6px); box-shadow: var(--shadow-lg); }
  .level-card.basic:hover { border-color: var(--teal); }
  .level-card.advanced:hover { border-color: var(--gold); }

  .lc-top { display: flex; align-items: center; gap: 14px; margin-bottom: 16px; }
  .lc-icon { width: 60px; height: 60px; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 42px; flex-shrink: 0; }
  .level-card.basic .lc-icon { background: var(--teal-light); }
  .level-card.advanced .lc-icon { background: var(--gold-light); }
  .lc-label { font-size: 11px; letter-spacing: 2px; text-transform: uppercase; font-weight: 800; margin-bottom: 4px; }
  .level-card.basic .lc-label { color: var(--teal); }
  .level-card.advanced .lc-label { color: var(--gold); }
  .lc-title { font-family: 'Playfair Display', serif; font-size: 24px; color: var(--navy); }
  .lc-pts { font-size: 13px; color: var(--gray); margin-bottom: 18px; }

  .lc-vids { display: flex; flex-direction: column; gap: 8px; margin-bottom: 24px; }
  .lc-vid-row { display: flex; align-items: center; gap: 10px; }
  .lc-vid-thumb {
    width: 48px; height: 34px; border-radius: 7px; object-fit: cover;
    flex-shrink: 0; background: var(--gray-light);
  }
  .lc-vid-thumb-placeholder {
    width: 48px; height: 34px; border-radius: 7px; flex-shrink: 0;
    background: var(--gray-light); display: flex; align-items: center; justify-content: center;
    font-size: 18px;
  }
  .lc-vid-name { font-size: 13px; font-weight: 600; color: var(--navy); }

  .lc-btn {
    width: 100%; padding: 14px; border-radius: 12px; border: none;
    font-family: 'Nunito', sans-serif; font-size: 15px; font-weight: 800;
    cursor: pointer; transition: all .2s;
  }
  .level-card.basic .lc-btn { background: linear-gradient(135deg, var(--teal), #0b7a6a); color: white; }
  .level-card.basic .lc-btn:hover { box-shadow: 0 4px 16px rgba(14,157,138,.35); }
  .level-card.advanced .lc-btn { background: linear-gradient(135deg, var(--gold), #e8931a); color: white; }
  .level-card.advanced .lc-btn:hover { box-shadow: 0 4px 16px rgba(245,166,35,.35); }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE 3: PRACTICE
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #page-practice { display: none; }

  .prac-header {
    background: linear-gradient(135deg, var(--navy), #0e3a5c);
    padding: 12px 24px; display: flex; align-items: center; gap: 12px;
  }
  .ph-badge { background: var(--gold); color: var(--navy); font-size: 11px; font-weight: 800; letter-spacing: 2px; padding: 4px 12px; border-radius: 30px; }
  .ph-level { font-size: 11px; font-weight: 800; letter-spacing: 2px; padding: 4px 12px; border-radius: 30px; text-transform: uppercase; }
  .ph-level.basic { background: rgba(14,157,138,.2); color: #5eead4; border: 1px solid rgba(14,157,138,.4); }
  .ph-level.advanced { background: rgba(245,166,35,.2); color: var(--gold); border: 1px solid rgba(245,166,35,.4); }
  .prac-header h1 { font-family: 'Playfair Display', serif; font-size: 18px; color: white; }
  .ph-student { margin-left: auto; background: rgba(255,255,255,.12); border-radius: 30px; padding: 6px 16px; font-size: 13px; font-weight: 700; color: white; }
  .back-btn { background: transparent; border: 1px solid rgba(255,255,255,.25); border-radius: 8px; color: rgba(255,255,255,.7); font-size: 12px; padding: 6px 12px; cursor: pointer; font-family: 'Nunito', sans-serif; transition: all .2s; }
  .back-btn:hover { border-color: white; color: white; }

  /* Timer strip */
  .timer-strip { background: white; border-bottom: 2px solid var(--border); padding: 8px 24px; display: flex; align-items: center; gap: 16px; }
  .countdown-wrap { display: flex; align-items: center; gap: 8px; }
  .countdown-label { font-size: 11px; color: var(--gray); text-transform: uppercase; letter-spacing: 1px; font-weight: 700; }
  .countdown-display { font-family: 'Playfair Display', serif; font-size: 26px; color: var(--navy); letter-spacing: 2px; min-width: 72px; transition: color .5s; font-weight: 700; }
  .countdown-display.warning { color: var(--orange); }
  .countdown-display.danger { color: var(--red); animation: blink 1s infinite; }
  @keyframes blink { 0%,100%{opacity:1} 50%{opacity:.4} }
  .timer-bar-wrap { flex: 1; max-width: 380px; background: var(--gray-light); border-radius: 20px; height: 8px; overflow: hidden; }
  .timer-bar { height: 100%; background: linear-gradient(90deg, var(--teal), #0b7a6a); border-radius: 20px; transition: width 1s linear, background .5s; }
  .timer-bar.warning { background: linear-gradient(90deg, var(--orange), #ea6c10); }
  .timer-bar.danger { background: linear-gradient(90deg, var(--red), #dc2626); }
  .timer-status { font-size: 12px; font-weight: 700; color: var(--gray); white-space: nowrap; }
  .timer-status.running { color: var(--teal); }
  .timer-status.warning { color: var(--orange); }
  .timer-status.danger { color: var(--red); }

  /* Video tabs */
  .vid-tabs-wrap { background: white; border-bottom: 2px solid var(--border); padding: 0 24px; display: flex; gap: 2px; overflow-x: auto; }
  .vid-tab { padding: 10px 16px; border: none; border-bottom: 3px solid transparent; background: transparent; color: var(--gray); font-family: 'Nunito', sans-serif; font-size: 13px; font-weight: 700; cursor: pointer; white-space: nowrap; transition: all .2s; flex-shrink: 0; display: flex; align-items: center; gap: 6px; }
  .vid-tab:hover { color: var(--navy); }
  .vid-tab.active { color: var(--teal); border-bottom-color: var(--teal); }
  .vid-tab img { width: 32px; height: 22px; border-radius: 4px; object-fit: cover; }
  .vid-tab .tab-emoji { font-size: 16px; }
  .vid-tab.all-done .tab-name::after { content: ' âœ…'; font-size: 11px; }

  /* Main layout */
  .main { display: grid; grid-template-columns: 1fr 440px; height: calc(100vh - 168px); }

  .video-panel { background: var(--bg); padding: 20px 24px; overflow-y: auto; display: flex; flex-direction: column; gap: 14px; }
  .video-title { font-family: 'Playfair Display', serif; font-size: 22px; color: var(--navy); font-weight: 700; }
  .video-sublevel { font-size: 11px; letter-spacing: 2px; text-transform: uppercase; margin-top: 2px; font-weight: 800; }
  .video-sublevel.basic { color: var(--teal); }
  .video-sublevel.advanced { color: var(--gold); }

  /* video thumb + link combined */
  .vid-link-card {
    display: flex; align-items: center; justify-content: center;
    text-decoration: none; border-radius: 18px;
    background: linear-gradient(135deg, #ff0000, #cc0000);
    border: none; transition: all .2s;
    box-shadow: 0 6px 28px rgba(255,0,0,.45);
    padding: 28px 24px; gap: 22px;
    min-height: 110px;
  }
  .vid-link-card:hover { transform: translateY(-3px); box-shadow: 0 12px 40px rgba(255,0,0,.6); background: linear-gradient(135deg, #ff1a1a, #dd0000); }
  .vid-thumb-wrap { display: none; }
  .vid-thumb-img { display: none !important; }
  .vid-thumb-emoji { display: none; }
  .vid-play-overlay { display: none; }
  .vid-play-btn {
    width: 64px; height: 64px; background: white; border-radius: 50%;
    display: flex; align-items: center; justify-content: center; font-size: 26px;
    color: #ff0000; box-shadow: 0 4px 16px rgba(0,0,0,.25);
    transition: transform .2s; padding-left: 4px; flex-shrink: 0;
  }
  .vid-link-card:hover .vid-play-btn { transform: scale(1.1); }
  @keyframes vidpulse {
    0% { box-shadow: 0 0 0 0 rgba(255,255,255,.6); }
    70% { box-shadow: 0 0 0 16px rgba(255,255,255,0); }
    100% { box-shadow: 0 0 0 0 rgba(255,255,255,0); }
  }
  .vid-play-btn { animation: vidpulse 2s infinite; }
  .vid-play-label { display: none; }
  .vid-link-footer {
    display: flex; flex-direction: column; align-items: flex-start; flex: 1;
    background: transparent; padding: 0;
  }
  .vid-link-footer strong { font-size: 19px; font-weight: 900; color: white; line-height: 1.2; }
  .vid-link-footer span { font-size: 13px; color: rgba(255,255,255,.8); margin-top: 5px; display: block; font-weight: 600; }
  .vid-ext-arrow {
    background: rgba(255,255,255,.2); color: white; font-size: 13px; font-weight: 800;
    padding: 6px 14px; border-radius: 20px; white-space: nowrap;
    border: 1.5px solid rgba(255,255,255,.4); flex-shrink: 0;
  }

  .video-note { background: #e0f7f4; border: 1.5px solid var(--teal); border-radius: 10px; padding: 11px 14px; font-size: 13px; color: #0b7a6a; line-height: 1.6; font-weight: 600; }

  .questions-box { background: white; border: 2px solid var(--border); border-radius: 14px; padding: 18px; box-shadow: var(--shadow); }
  .questions-box h3 { font-size: 11px; letter-spacing: 2px; text-transform: uppercase; color: var(--teal); margin-bottom: 14px; font-weight: 800; }
  .q-row { display: flex; gap: 10px; margin-bottom: 12px; align-items: flex-start; }
  .q-num { min-width: 26px; height: 26px; background: var(--gold); color: white; border-radius: 50%; font-weight: 800; font-size: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
  .q-text { font-size: 14px; line-height: 1.65; color: var(--navy); font-weight: 600; }

  /* Recorder panel */
  .recorder-panel { background: white; border-left: 2px solid var(--border); overflow-y: auto; padding: 18px 16px; display: flex; flex-direction: column; gap: 11px; }
  .recorder-panel h2 { font-family: 'Playfair Display', serif; font-size: 18px; color: var(--navy); }
  .rp-sub { font-size: 13px; color: var(--gray); line-height: 1.5; margin-top: 3px; font-weight: 600; }

  .instructions { background: var(--green-light); border: 1.5px solid var(--green); border-radius: 10px; padding: 12px 14px; font-size: 13px; color: #166534; line-height: 1.7; font-weight: 600; }
  .instructions b { color: #14532d; }

  .perm-error { background: #fef2f2; border: 1.5px solid var(--red); border-radius: 10px; padding: 11px; font-size: 13px; color: #b91c1c; display: none; font-weight: 600; }
  .perm-error.show { display: block; }

  /* Question recording cards */
  .qcard { background: var(--gray-light); border: 2px solid var(--border); border-radius: 12px; padding: 13px 14px; transition: all .2s; }
  .qcard.rec-active { border-color: var(--red); background: #fef2f2; }
  .qcard.rec-done { border-color: var(--teal); background: var(--teal-light); }
  .qcard.locked { opacity: .45; pointer-events: none; }
  .qcard-header { display: flex; gap: 9px; align-items: flex-start; margin-bottom: 10px; }
  .qcard .q-num { background: var(--navy); }
  .qcard .q-text { font-size: 13px; color: var(--navy); }
  .qcard-controls { display: flex; gap: 7px; align-items: center; flex-wrap: wrap; }

  .btn-sm { padding: 7px 14px; border-radius: 8px; border: none; font-family: 'Nunito', sans-serif; font-size: 13px; font-weight: 800; cursor: pointer; transition: all .2s; }
  .btn-rec { background: var(--teal); color: white; }
  .btn-rec:hover { background: #0b7a6a; }
  .btn-stop { background: var(--red); color: white; }
  .btn-stop:hover { background: #dc2626; }
  .btn-del { background: transparent; border: 2px solid var(--border); color: var(--gray); padding: 6px 9px; }
  .btn-del:hover { border-color: var(--red); color: var(--red); }

  .timer-sm { font-size: 13px; color: var(--red); font-weight: 800; display: flex; align-items: center; gap: 5px; }
  .pulse-dot { width: 8px; height: 8px; background: var(--red); border-radius: 50%; animation: pulse 1s infinite; }
  @keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.3;transform:scale(.6)} }

  .audio-row { margin-top: 9px; display: flex; flex-direction: column; gap: 5px; }
  .audio-row audio { width: 100%; height: 32px; }
  .audio-meta { display: flex; align-items: center; justify-content: space-between; }
  .saved-label { font-size: 12px; color: var(--teal); font-weight: 700; }
  .dl-link { font-size: 12px; color: var(--gray); text-decoration: none; border: 2px solid var(--border); border-radius: 7px; padding: 3px 10px; font-weight: 700; transition: all .2s; }
  .dl-link:hover { border-color: var(--teal); color: var(--teal); }

  /* Progress */
  .prog-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
  .prog-row span { font-size: 12px; color: var(--gray); font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
  .progress-bar-wrap { background: var(--gray-light); border-radius: 20px; height: 8px; overflow: hidden; }
  .progress-bar { height: 100%; background: linear-gradient(90deg, var(--teal), #0b7a6a); border-radius: 20px; transition: width .4s; }

  /* Submit section */
  .submit-section { background: var(--gold-light); border: 2px solid var(--gold); border-radius: 14px; padding: 16px; display: flex; flex-direction: column; gap: 11px; }
  .submit-section h3 { font-family: 'Playfair Display', serif; font-size: 16px; color: var(--navy); }
  .submit-desc { font-size: 13px; color: var(--gray); line-height: 1.6; font-weight: 600; }
  .download-all-btn { width: 100%; padding: 13px; border-radius: 10px; border: none; background: linear-gradient(135deg, var(--gold), #e8931a); color: white; font-family: 'Nunito', sans-serif; font-size: 15px; font-weight: 800; cursor: pointer; transition: all .2s; }
  .download-all-btn:hover { box-shadow: 0 4px 16px rgba(245,166,35,.4); transform: translateY(-1px); }
  .download-all-btn:disabled { background: #cbd5e1; color: #94a3b8; cursor: not-allowed; transform: none; box-shadow: none; }
  .submit-steps { background: white; border-radius: 10px; padding: 12px 14px; font-size: 13px; color: var(--gray); line-height: 1.8; display: flex; flex-direction: column; gap: 5px; font-weight: 600; }
  .step { display: flex; gap: 8px; align-items: flex-start; }
  .step-num { min-width: 20px; height: 20px; background: var(--gold); border-radius: 50%; font-size: 11px; font-weight: 800; color: white; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px; }

  /* TIME'S UP OVERLAY */
  .timesup-overlay { display: none; position: fixed; inset: 0; background: rgba(15,25,50,.88); z-index: 1000; align-items: center; justify-content: center; backdrop-filter: blur(8px); }
  .timesup-overlay.show { display: flex; }
  .timesup-card { background: white; border-radius: 24px; padding: 48px 44px; text-align: center; max-width: 460px; width: 90%; animation: popIn .5s cubic-bezier(.175,.885,.32,1.275); box-shadow: 0 20px 60px rgba(0,0,0,.4); }
  @keyframes popIn { from{opacity:0;transform:scale(.7)} to{opacity:1;transform:scale(1)} }
  .trophy { font-size: 68px; margin-bottom: 12px; animation: bounce 1.5s ease infinite; }
  @keyframes bounce { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-12px)} }
  .timesup-card h2 { font-family: 'Playfair Display', serif; font-size: 34px; color: var(--navy); margin-bottom: 6px; }
  .overlay-name { font-size: 20px; color: var(--teal); margin-bottom: 10px; font-weight: 800; }
  .timesup-card p { font-size: 15px; color: var(--gray); line-height: 1.7; margin-bottom: 18px; font-weight: 600; }
  .timesup-card .stars { font-size: 42px; margin-bottom: 14px; letter-spacing: 6px; }
  .rec-summary { background: var(--gray-light); border-radius: 10px; padding: 12px 16px; margin-bottom: 18px; font-size: 14px; color: var(--navy); font-weight: 600; }
  .rec-summary b { color: var(--teal); }
  .overlay-dl-btn { padding: 14px 28px; border-radius: 12px; border: none; background: linear-gradient(135deg, var(--gold), #e8931a); color: white; font-family: 'Nunito', sans-serif; font-size: 15px; font-weight: 800; cursor: pointer; transition: all .2s; width: 100%; }
  .overlay-dl-btn:hover { box-shadow: 0 4px 16px rgba(245,166,35,.4); }
  .overlay-dl-btn:disabled { background: #cbd5e1; color: #94a3b8; cursor: not-allowed; }
  .overlay-cont-btn { padding: 12px 28px; border-radius: 12px; border: 2px solid var(--border); background: white; color: var(--gray); font-family: 'Nunito', sans-serif; font-size: 14px; font-weight: 700; cursor: pointer; transition: all .2s; width: 100%; margin-top: 8px; }
  .overlay-cont-btn:hover { border-color: var(--teal); color: var(--teal); }
</style>
</head>
<body>

<!-- TIME'S UP OVERLAY -->
<div class="timesup-overlay" id="timesup-overlay">
  <div class="timesup-card">
    <div class="trophy">ğŸ†</div>
    <div class="stars">â­â­â­</div>
    <h2>Well Done!</h2>
    <div class="overlay-name" id="overlay-name"></div>
    <p>You did your best!<br>Time is up for this video.<br>Download your recordings and submit to Google Classroom.</p>
    <div class="rec-summary" id="overlay-summary"></div>
    <button class="overlay-dl-btn" id="overlay-dl-btn" onclick="overlayDownload()">â¬‡ Download My Recordings</button>
    <button class="overlay-cont-btn" onclick="closeOverlay()">Continue / Review Answers</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE 1 â€” NAME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-name">
  <div class="name-screen-logo">COBE 2026</div>
  <h1>English<br><span>Speaking Practice</span></h1>
  <p class="tagline">Watch Â· Record Â· Submit Â· Succeed</p>

  <div class="name-card">
    <div class="avatar">ğŸ‘‹</div>
    <h2>Welcome! What's your name?</h2>
    <p>Enter your full name so your teacher can identify your recordings.</p>
    <div class="name-input-wrap">
      <input type="text" id="name-input" placeholder="e.g. Dana Cohen"
        oninput="onNameInput()" onkeydown="if(event.key==='Enter') tryNext()" autofocus />
    </div>
    <button class="name-next-btn" id="name-next-btn" onclick="tryNext()" disabled>
      Let's Go! â†’
    </button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE 2 â€” LEVEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-level">
  <div class="level-header">
    <div class="badge">COBE 2026</div>
    <h1>Choose Your Level</h1>
    <div class="greeting-chip" id="greeting-chip">ğŸ‘‹ Hi, Student!</div>
  </div>

  <div class="level-body">
    <h2>Which level are you practising?</h2>
    <p class="sub">Choose the level that matches your class</p>

    <div class="level-cards">
      <!-- BASIC -->
      <div class="level-card basic" onclick="enterLevel('basic')">
        <div class="lc-top">
          <div class="lc-icon">ğŸŒ¿</div>
          <div>
            <div class="lc-label">Level 1 Â· 016486</div>
            <div class="lc-title">Basic</div>
          </div>
        </div>
        <p class="lc-pts">4 points Â· 6 videos Â· 15 min per video</p>
        <div class="lc-vids" id="basic-vid-list"></div>
        <button class="lc-btn">Start Basic Level â†’</button>
      </div>

      <!-- ADVANCED -->
      <div class="level-card advanced" onclick="enterLevel('advanced')">
        <div class="lc-top">
          <div class="lc-icon">ğŸŒŸ</div>
          <div>
            <div class="lc-label">Level 2 Â· 16586</div>
            <div class="lc-title">Advanced</div>
          </div>
        </div>
        <p class="lc-pts">5 points Â· 6 videos Â· 15 min per video</p>
        <div class="lc-vids" id="advanced-vid-list"></div>
        <button class="lc-btn">Start Advanced Level â†’</button>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE 3 â€” PRACTICE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-practice">
  <div class="prac-header">
    <div class="ph-badge">COBE 2026</div>
    <div class="ph-level" id="ph-level"></div>
    <div>
      <h1 id="ph-title">Practice</h1>
    </div>
    <div class="ph-student" id="ph-student"></div>
    <button class="back-btn" onclick="goToLevel()">â† Levels</button>
  </div>

  <div class="timer-strip">
    <div class="countdown-wrap">
      <span class="countdown-label">â± Time left</span>
      <div class="countdown-display" id="countdown-display">15:00</div>
    </div>
    <div class="timer-bar-wrap">
      <div class="timer-bar" id="timer-bar" style="width:100%"></div>
    </div>
    <div class="timer-status" id="timer-status">Not started â€” click the video to begin</div>
  </div>

  <div class="vid-tabs-wrap" id="vid-tabs"></div>

  <div class="main">
    <div class="video-panel">
      <div>
        <div class="video-title" id="vid-title"></div>
        <div class="video-sublevel" id="vid-sublevel"></div>
      </div>

      <a id="vid-link" href="#" target="_blank" class="vid-link-card" onclick="onVideoClick()">
        <div class="vid-play-btn">â–¶</div>
        <div class="vid-thumb-wrap" style="display:none">
          <div class="vid-thumb-emoji" id="vid-thumb-emoji"></div>
          <img id="vid-thumb-img" src="" alt="" class="vid-thumb-img" style="display:none" onload="this.style.display='block'" onerror="if(this.src.includes('maxresdefault')){this.src=this.src.replace('maxresdefault','hqdefault')}else{this.style.display='none'}" />
        </div>
        <div class="vid-link-footer">
          <strong id="vid-link-label"></strong>
          <span>â± Timer starts automatically â€” opens in new tab</span>
        </div>
        <div class="vid-ext-arrow">â†— Open</div>
      </a>

      <div class="video-note">
        ğŸ’¡ The 15-minute timer starts when you click the video. Watch it, then come back here to record your answers.
      </div>

      <div class="questions-box">
        <h3>ğŸ“‹ Questions â€” Answer All</h3>
        <div id="questions-list"></div>
      </div>
    </div>

    <div class="recorder-panel">
      <div>
        <h2>ğŸ™ï¸ Record Your Answers</h2>
        <p class="rp-sub">Each question has its own recorder. Press <b style="color:var(--teal)">â— Record</b>, speak, then <b style="color:var(--red)">â–  Stop</b>.</p>
      </div>
      <div class="instructions">
        <b>Steps:</b><br>
        1. Click the video â€” the timer starts automatically<br>
        2. Watch the video, then come back here<br>
        3. Press <b>â— Record</b> for each question and answer it<br>
        4. Press <b>â–  Stop</b> â€” listen back and re-record if needed<br>
        5. Download all files and upload to Google Classroom
      </div>
      <div class="perm-error" id="perm-error">âš ï¸ Microphone access denied. Please allow the microphone in your browser and refresh.</div>
      <div>
        <div class="prog-row">
          <span>Progress</span>
          <span id="prog-label">0 / 4 recorded</span>
        </div>
        <div class="progress-bar-wrap"><div class="progress-bar" id="prog-bar" style="width:0%"></div></div>
      </div>
      <div id="recorder-cards"></div>
      <div class="submit-section">
        <h3>ğŸ“¤ Submit to Google Classroom</h3>
        <p class="submit-desc">Download all your recordings, then upload them to the assignment.</p>
        <button class="download-all-btn" id="download-all-btn" onclick="downloadAll()" disabled>â¬‡ Download All Recordings</button>
        <div class="submit-steps">
          <div class="step"><div class="step-num">1</div><span>Record your answers above</span></div>
          <div class="step"><div class="step-num">2</div><span>Click <b>Download All Recordings</b></span></div>
          <div class="step"><div class="step-num">3</div><span>Go to Google Classroom â†’ open the assignment â†’ <b>Add or create â†’ File</b> â†’ upload the files</span></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const TOTAL_SECONDS = 15 * 60;

// YouTube thumbnail helper
function ytThumb(url) {
  const m = url.match(/(?:youtu\.be\/|v=|v\/|embed\/)([a-zA-Z0-9_-]{11})/);
  return m ? `https://img.youtube.com/vi/${m[1]}/maxresdefault.jpg` : '';
}

const allVideos = {
  basic: [
    { title:"Galapagos_Islands", displayTitle:"Galapagos Islands", emoji:"ğŸŒ¿",
      url:"https://youtu.be/zx5mbtf_Eu8?t=919",
      questions:["What two facts do we learn about the Galapagos Islands?","What do we know about the Galapagos penguins? Name two things.","According to the clip, what is \"adaptation\"? Explain.","How have the iguanas adapted to the Galapagos Islands? Explain."] },
    { title:"Rainforests", displayTitle:"Rainforests", emoji:"ğŸŒ³",
      url:"https://youtu.be/j-hgPRTfKms?t=245",
      questions:["Name three facts we learn about rainforests.","What is deforestation? Explain.","Why was Kids Saving The Rainforest organization founded? Give two reasons.","What have the people in this organization done? Give two examples and explain."] },
    { title:"Making_Snow", displayTitle:"Making Snow", emoji:"â„ï¸",
      url:"https://youtu.be/lyhR2ApY-fA?t=248",
      questions:["What is the problem presented in the clip?","According to the clip, what is the solution for this problem? Explain.","Can this machine be used anywhere? Explain.","In your opinion, is the solution presented in the clip effective? Give an example and explain."] },
    { title:"Lifeguard_Dogs", displayTitle:"Lifeguard Dogs", emoji:"ğŸ•",
      url:"https://youtu.be/ldHv-0eRSiw?t=439",
      questions:["What do we know about Beacon and Buoy? Name two things.","According to the clip, what can a water rescue dog do? Give two examples.","Why are Beacon and Buoy so suitable for this job? Explain.","Based on the clip, is it a good idea to have a dog on the lifeguard team? Explain."] },
    { title:"Dolphins", displayTitle:"Dolphins", emoji:"ğŸ¬",
      url:"https://youtu.be/paByxq_i5eY?t=692",
      questions:["Name three facts we learn about dolphins.","How are dolphins similar to human beings? Give two examples.","According to the clip, why is it important to protect our oceans? Explain.","What is the most interesting thing you learned from this clip? Explain."] },
    { title:"Kindness_101_Empathy", displayTitle:"Kindness 101 â€“ Empathy", emoji:"ğŸ’›",
      url:"https://www.youtube.com/watch?v=6HfnDjWblfU",
      questions:["Explain \"empathy\" as used in the clip.","List two facts about Austin.","How did Austin learn about homeless people? Explain.","Describe what he does as a result."] }
  ],
  advanced: [
    { title:"Japan_Kids_Walk_to_School", displayTitle:"Japan: Kids Walk to School", emoji:"ğŸ’",
      url:"https://www.youtube.com/watch?v=IkVvXVDs5aI",
      questions:["What is surprising about the young boy's daily routine? Explain.","Describe the young boy's journey to school.","Why do parents in Japan feel comfortable with this way of life? Give two examples and explain.","In your opinion, would parents in Israel be comfortable with this way of life? Explain."] },
    { title:"London_Tube_Map", displayTitle:"The London Tube Map", emoji:"ğŸ—ºï¸",
      url:"https://www.youtube.com/watch?v=iBErp8qvWZg",
      questions:["According to the clip, why was the original map of the London Tube complicated? Give two examples and explain.","What changes occurred when Harry Beck understood that people just wanted to get from one station to another? Give two examples and explain.","How do we know that Beck's Tube map became a success story? Explain.","The speaker mentions three design principles. Choose one and give an example of how it was applied to the map."] },
    { title:"How_Friendship_Affects_Your_Brain", displayTitle:"How Friendship Affects Your Brain", emoji:"ğŸ§ ",
      url:"https://www.youtube.com/watch?v=YmVpwXH4jhA",
      questions:["Why is Priya considered a great friend? Give two examples and explain.","What makes adolescent friendships so special? Give two examples and explain.","According to the clip, what is \"Theory of Mind\"? How does this affect friendships in adolescence? Explain."] },
    { title:"Pandas", displayTitle:"Pandas", emoji:"ğŸ¼",
      url:"https://youtu.be/nO4kScRGYJY?t=555",
      questions:["Describe the conservation partnership between China and the United States.","According to the clip, what do we learn about pandas? Give two examples.","According to the clip, are pandas considered critically endangered? Explain.","What is the most interesting thing you learned from this clip? Explain."] },
    { title:"Do_You_Need_8_Hours_of_Sleep", displayTitle:"Do You Need 8 Hours of Sleep?", emoji:"ğŸ˜´",
      url:"https://www.youtube.com/watch?v=fQUeDdaVoWo",
      questions:["What issue does the speaker raise at the beginning of her talk?","According to the clip, is it true that people need 7â€“8 hours of sleep every night? Explain.","What does the speaker mean when she says that constantly thinking about your sleep may cause more sleep problems? Explain.","At the end of the clip, the speaker offers suggestions. Which do you find the most useful? Explain."] },
    { title:"The_Power_of_Words", displayTitle:"The Power of Words", emoji:"ğŸ’¬",
      url:"https://www.youtube.com/watch?v=hmX8FBNo2no",
      questions:["At the beginning of the clip, the speaker makes claims that are not true. What makes people believe him?","What does the speaker mean when he says \"A simple choice of words can make a difference\"? Explain.","According to the clip, how does the speaker react both times when he sees his son drawing on the wall? Which reaction was more effective? Explain."] }
  ]
};

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let studentName = '';
let currentLevel = 'basic';
let currentVI = 0;
let videos = [];
let timerState = [];
let recordings = [];
let active = null;

// â”€â”€ PAGE 1: Name â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function onNameInput() {
  const val = document.getElementById('name-input').value.trim();
  document.getElementById('name-next-btn').disabled = val.length < 2;
}
function tryNext() {
  const val = document.getElementById('name-input').value.trim();
  if (val.length < 2) return;
  studentName = val;
  showLevelPage();
}

// â”€â”€ PAGE 2: Level â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showLevelPage() {
  document.getElementById('page-name').style.display = 'none';
  document.getElementById('page-level').style.display = 'block';
  document.getElementById('greeting-chip').textContent = `ğŸ‘‹ Hi, ${studentName}!`;
  buildLevelLists();
}

function buildLevelLists() {
  ['basic','advanced'].forEach(level => {
    const el = document.getElementById(`${level}-vid-list`);
    el.innerHTML = allVideos[level].map(v => {
      const thumb = ytThumb(v.url);
      return `<div class="lc-vid-row">
        ${thumb
          ? `<img class="lc-vid-thumb" src="${thumb}" alt="${v.displayTitle}" onerror="this.outerHTML='<div class=\\'lc-vid-thumb-placeholder\\'>${v.emoji}</div>'">`
          : `<div class="lc-vid-thumb-placeholder">${v.emoji}</div>`}
        <span class="lc-vid-name">${v.displayTitle}</span>
      </div>`;
    }).join('');
  });
}

function enterLevel(level) {
  currentLevel = level;
  videos = allVideos[level];
  timerState = videos.map(() => ({ started:false, expired:false, remaining:TOTAL_SECONDS, interval:null }));
  recordings = videos.map(v => v.questions.map(() => null));
  active = null; currentVI = 0;

  document.getElementById('page-level').style.display = 'none';
  document.getElementById('page-practice').style.display = 'block';

  const lvlBadge = document.getElementById('ph-level');
  lvlBadge.textContent = level === 'basic' ? 'ğŸŒ¿ Basic â€“ 4 pts' : 'ğŸŒŸ Advanced â€“ 5 pts';
  lvlBadge.className = 'ph-level ' + level;
  document.getElementById('ph-title').textContent = level === 'basic' ? 'Basic Level Practice' : 'Advanced Level Practice';
  document.getElementById('ph-student').textContent = 'ğŸ‘¤ ' + studentName;

  buildTabs(); loadVideo(0);
}

function goToLevel() {
  if (active) forceStop();
  timerState.forEach(ts => { if (ts.interval) clearInterval(ts.interval); });
  document.getElementById('page-practice').style.display = 'none';
  document.getElementById('page-level').style.display = 'block';
}

// â”€â”€ Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildTabs() {
  const wrap = document.getElementById('vid-tabs');
  wrap.innerHTML = '';
  videos.forEach((v, i) => {
    const btn = document.createElement('button');
    btn.className = 'vid-tab' + (i === 0 ? ' active' : '');
    btn.id = `vbtn-${i}`;
    const thumb = ytThumb(v.url);
    btn.innerHTML = thumb
      ? `<img src="${thumb}" alt="" onerror="if(this.src.includes('maxresdefault')){this.src=this.src.replace('maxresdefault','hqdefault')}else{this.outerHTML='<span class=\\'tab-emoji\\'>${v.emoji}</span>'}" /><span class="tab-name">${v.displayTitle}</span>`
      : `<span class="tab-emoji">${v.emoji}</span><span class="tab-name">${v.displayTitle}</span>`;
    btn.onclick = () => loadVideo(i);
    wrap.appendChild(btn);
  });
}

function loadVideo(vi) {
  if (active) forceStop();
  currentVI = vi;
  document.querySelectorAll('.vid-tab').forEach((b, i) => b.classList.toggle('active', i === vi));
  const v = videos[vi];
  document.getElementById('vid-title').textContent = v.displayTitle;
  const sl = document.getElementById('vid-sublevel');
  sl.textContent = currentLevel === 'basic' ? 'Basic Level Â· 4 points' : 'Advanced Level Â· 5 points';
  sl.className = 'video-sublevel ' + currentLevel;
  document.getElementById('vid-link').href = v.url;
  document.getElementById('vid-link-label').textContent = 'Watch: ' + v.displayTitle;

  // thumbnail
  const thumb = ytThumb(v.url);
  const img = document.getElementById('vid-thumb-img');
  const emo = document.getElementById('vid-thumb-emoji');
  if (thumb) { img.src = thumb; emo.style.display = 'none'; }
  else { img.style.display = 'none'; emo.textContent = v.emoji; emo.style.display = 'flex'; }

  document.getElementById('questions-list').innerHTML = v.questions.map((q, i) =>
    `<div class="q-row"><div class="q-num">${i+1}</div><div class="q-text">${q}</div></div>`).join('');

  updateTimerUI(vi); renderCards(vi);
}

// â”€â”€ Timer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function onVideoClick() {
  const ts = timerState[currentVI];
  if (!ts.started && !ts.expired) startCountdown(currentVI);
}
function startCountdown(vi) {
  const ts = timerState[vi];
  if (ts.started || ts.expired) return;
  ts.started = true;
  ts.interval = setInterval(() => {
    ts.remaining--;
    if (vi === currentVI) updateTimerUI(vi);
    if (ts.remaining <= 0) {
      clearInterval(ts.interval); ts.expired = true; ts.remaining = 0;
      if (vi === currentVI) { updateTimerUI(vi); lockVideo(vi); showTimesUp(vi); }
    }
  }, 1000);
  if (vi === currentVI) updateTimerUI(vi);
}
function updateTimerUI(vi) {
  const ts = timerState[vi]; const rem = ts.remaining;
  const pct = (rem / TOTAL_SECONDS) * 100;
  const disp = document.getElementById('countdown-display');
  const bar = document.getElementById('timer-bar');
  const stat = document.getElementById('timer-status');
  disp.textContent = `${Math.floor(rem/60).toString().padStart(2,'0')}:${(rem%60).toString().padStart(2,'0')}`;
  bar.style.width = pct + '%';
  if (!ts.started) {
    disp.className='countdown-display'; bar.className='timer-bar';
    stat.textContent='Not started â€” click the video to begin'; stat.className='timer-status';
  } else if (rem<=0) {
    disp.className='countdown-display danger'; bar.className='timer-bar danger'; bar.style.width='0%';
    stat.textContent="Time's up!"; stat.className='timer-status danger';
  } else if (rem<=120) {
    disp.className='countdown-display danger'; bar.className='timer-bar danger';
    stat.textContent='Hurry up!'; stat.className='timer-status danger';
  } else if (rem<=300) {
    disp.className='countdown-display warning'; bar.className='timer-bar warning';
    stat.textContent='5 minutes left!'; stat.className='timer-status warning';
  } else {
    disp.className='countdown-display'; bar.className='timer-bar';
    stat.textContent='Timer running'; stat.className='timer-status running';
  }
}
function lockVideo(vi) {
  if (active && active.vi===vi) forceStop();
  document.querySelectorAll(`[id^="qcard-${vi}-"]`).forEach(c=>c.classList.add('locked'));
}
function showTimesUp(vi) {
  const done = recordings[vi].filter(r=>r!==null).length;
  document.getElementById('overlay-name').textContent = studentName;
  document.getElementById('overlay-summary').innerHTML =
    `You recorded <b>${done} out of ${videos[vi].questions.length}</b> questions for <b>${videos[vi].displayTitle}</b>.`;
  document.getElementById('overlay-dl-btn').disabled = done === 0;
  document.getElementById('timesup-overlay').classList.add('show');
}
function closeOverlay() { document.getElementById('timesup-overlay').classList.remove('show'); }
function overlayDownload() { closeOverlay(); downloadAll(); }

// â”€â”€ Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderCards(vi) {
  const c = document.getElementById('recorder-cards'); c.innerHTML = '';
  videos[vi].questions.forEach((q, qi) => c.appendChild(makeCard(vi, qi, q)));
  updateProgress(vi); updateDownloadBtn();
}
function makeCard(vi, qi, q) {
  const div = document.createElement('div');
  div.className = 'qcard'; div.id = `qcard-${vi}-${qi}`;
  const rec = recordings[vi][qi];
  const isActive = active && active.vi===vi && active.qi===qi;
  if (isActive) div.classList.add('rec-active');
  else if (rec) div.classList.add('rec-done');
  if (timerState[vi].expired) div.classList.add('locked');
  div.innerHTML = `
    <div class="qcard-header"><div class="q-num">${qi+1}</div><div class="q-text">${q}</div></div>
    <div class="qcard-controls" id="ctrl-${vi}-${qi}">${ctrlHTML(vi,qi,isActive,rec)}</div>
    ${rec ? audioHTML(vi,qi,rec) : ''}`;
  return div;
}
function ctrlHTML(vi, qi, isActive, rec) {
  if (isActive) return `<button class="btn-sm btn-stop" onclick="stopRec(${vi},${qi})">â–  Stop</button>
    <div class="timer-sm"><span class="pulse-dot"></span><span id="tim-${vi}-${qi}">00:00</span></div>`;
  return `<button class="btn-sm btn-rec" onclick="startRec(${vi},${qi})">${rec?'â†º Re-record':'â— Record'}</button>
    ${rec?`<button class="btn-sm btn-del" onclick="delRec(${vi},${qi})">âœ•</button>`:''}`;
}
function audioHTML(vi, qi, rec) {
  const fname = `${studentName.replace(/\s+/g,'_')}_${videos[vi].title}_Q${qi+1}.webm`;
  return `<div class="audio-row"><audio controls src="${rec.url}"></audio>
    <div class="audio-meta"><span class="saved-label">âœ… ${rec.duration}</span>
    <a class="dl-link" href="${rec.url}" download="${fname}">â¬‡ Download</a></div></div>`;
}

// â”€â”€ Recording â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function startRec(vi, qi) {
  if (timerState[vi].expired) return;
  if (active) forceStop();
  if (!timerState[vi].started) startCountdown(vi);
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    const mr = new MediaRecorder(stream);
    const chunks = [];
    mr.ondataavailable = e => { if (e.data.size>0) chunks.push(e.data); };
    active = { vi, qi, mr, chunks, interval:null, sec:0 };
    const card = document.getElementById(`qcard-${vi}-${qi}`);
    card.classList.add('rec-active'); card.classList.remove('rec-done');
    const old = card.querySelector('.audio-row'); if (old) old.remove();
    document.getElementById(`ctrl-${vi}-${qi}`).innerHTML = ctrlHTML(vi,qi,true,null);
    active.interval = setInterval(() => {
      active.sec++;
      const el = document.getElementById(`tim-${vi}-${qi}`);
      if (el) el.textContent = fmt(active.sec);
    }, 1000);
    mr.start(100);
    document.getElementById('perm-error').classList.remove('show');
  } catch(e) { document.getElementById('perm-error').classList.add('show'); }
}
function stopRec(vi, qi) {
  if (!active||active.vi!==vi||active.qi!==qi) return;
  clearInterval(active.interval);
  const { mr, chunks, sec } = active; active = null;
  mr.onstop = () => {
    if (mr.stream) mr.stream.getTracks().forEach(t=>t.stop());
    recordings[vi][qi] = { url:URL.createObjectURL(new Blob(chunks,{type:'audio/webm'})), duration:fmt(sec) };
    if (currentVI===vi) {
      const card = document.getElementById(`qcard-${vi}-${qi}`);
      card.classList.remove('rec-active'); card.classList.add('rec-done');
      document.getElementById(`ctrl-${vi}-${qi}`).innerHTML = ctrlHTML(vi,qi,false,recordings[vi][qi]);
      const old = card.querySelector('.audio-row'); if (old) old.remove();
      card.insertAdjacentHTML('beforeend', audioHTML(vi,qi,recordings[vi][qi]));
      updateProgress(vi);
    }
    updateDownloadBtn(); updateTabBadges();
  };
  if (mr.state!=='inactive') mr.stop();
}
function delRec(vi, qi) {
  recordings[vi][qi] = null;
  if (currentVI===vi) {
    const card = document.getElementById(`qcard-${vi}-${qi}`);
    card.classList.remove('rec-done');
    document.getElementById(`ctrl-${vi}-${qi}`).innerHTML = ctrlHTML(vi,qi,false,null);
    const old = card.querySelector('.audio-row'); if (old) old.remove();
    updateProgress(vi);
  }
  updateDownloadBtn(); updateTabBadges();
}
function forceStop() {
  if (!active) return;
  clearInterval(active.interval);
  try { active.mr.stop(); active.mr.stream.getTracks().forEach(t=>t.stop()); } catch(e){}
  active = null;
}

// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateProgress(vi) {
  const done = recordings[vi].filter(r=>r!==null).length;
  const total = videos[vi].questions.length;
  document.getElementById('prog-label').textContent = `${done} / ${total} recorded`;
  document.getElementById('prog-bar').style.width = `${(done/total)*100}%`;
}
function updateTabBadges() {
  videos.forEach((_,vi) => {
    const b = document.getElementById(`vbtn-${vi}`);
    if (b) b.classList.toggle('all-done', recordings[vi].every(r=>r!==null));
  });
}
function updateDownloadBtn() {
  const vi = currentVI;
  const done = recordings[vi].filter(r=>r!==null).length;
  const btn = document.getElementById('download-all-btn');
  btn.disabled = done === 0;
  btn.textContent = done===0 ? 'â¬‡ Record at least one question first' : `â¬‡ Download ${done} Recording${done>1?'s':''}`;
}
function downloadAll() {
  const vi = currentVI;
  const name = studentName.replace(/\s+/g,'_');
  recordings[vi].forEach((rec,qi) => {
    if (!rec) return;
    const a = document.createElement('a');
    a.href = rec.url; a.download = `${name}_${videos[vi].title}_Q${qi+1}.webm`;
    document.body.appendChild(a); a.click(); document.body.removeChild(a);
  });
}
function fmt(s) {
  return `${Math.floor(s/60).toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`;
}

// Init â€” show name page
document.getElementById('page-name').style.display = 'flex';
</script>
</body>
</html>
